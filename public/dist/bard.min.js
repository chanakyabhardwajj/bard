"use strict";var bard=angular.module("bard",["ngCookies","ngResource","ngRoute","ngSanitize","ngAnimate","ui.bootstrap","ui.route","bard.Articles","bard.Authors","bard.UserStatus"]);bard.run(["$rootScope",function($root){$root.$on("$routeChangeStart",function(e,curr){curr.$$route&&curr.$$route.resolve&&($root.loadingView=!0,console.log("loading view TRUE"))}),$root.$on("$routeChangeSuccess",function(){$root.loadingView=!1,console.log("loading view FALSE")})}]),angular.module("bard.Articles",[]),angular.module("bard.Authors",[]),angular.module("bard.UserStatus",[]),angular.module("bard.Articles").factory("ArticlesService",["$resource",function($resource){return $resource("articles/:articleId",{articleId:"@_id"},{update:{method:"PUT"}})}]),angular.module("bard.Authors").factory("AuthorsService",["$resource",function($resource){return $resource("users/:username",{username:"@username"})}]),angular.module("bard.UserStatus").factory("UserStatusService",[function(){var _this=this;return _this._data={user:window.user,authenticated:!!window.user},_this._data}]),angular.module("bard.Articles").directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",link:function(scope,element,attrs,ngModel){function read(){var html=element.html();attrs.stripBr&&"<br>"===html&&(html=""),ngModel.$setViewValue(html)}ngModel&&(ngModel.$render=function(){element.html(ngModel.$viewValue||"")},ngModel.$setPristine(),ngModel.$dirty=!1,element.on("blur keyup change",function(){scope.$apply(read)}),read())}}}).directive("keypress",function(){function bindKey(k,scope,element,attributes){window.Mousetrap.bind(k,function(){return attributes[k](scope,element)})}return function(scope,element,attrs){var attributes=scope.$eval(attrs.keypress||"{}");for(var k in attributes)bindKey(k,scope,element,attributes)}}).directive("backImg",function(){return function(scope,element,attrs){var url=attrs.backImg;element.css({"background-image":"url("+url+")","background-size":"cover"})}}),angular.module("bard.Articles").filter("fromNow",["$window",function($window){return function(date){return $window.moment(date).fromNow()}}]).filter("truncate",function(){return function(value,wordwise,max,tail){if(!value)return"";if(max=parseInt(max,10),!max)return value;if(value.length<=max)return value;if(value=value.substr(0,max),wordwise){var lastspace=value.lastIndexOf(" ");-1!==lastspace&&(value=value.substr(0,lastspace))}return value+(tail||" â€¦")}}).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),angular.module("bard.UserStatus").directive("typer",function(){return{restrict:"A",link:function(scope,element,attrs){angular.element(element).typer(scope.$eval(attrs.typer))}}}),angular.module("bard.Articles").controller("AllArticlesController",["$scope","$window","$timeout","UserStatusService","ArticlesService","resolvedArticles",function($scope,$window,$timeout,UserStatusService,ArticlesService,resolvedArticles){$scope.userStatus=UserStatusService,$scope.articles=resolvedArticles}]),angular.module("bard.Articles").controller("EditArticleController",["$scope","$routeParams","$location","$timeout","$sanitize","UserStatusService","ArticlesService","resolvedArticle",function($scope,$routeParams,$location,$timeout,$sanitize,UserStatusService,ArticlesService,resolvedArticle){$scope.userStatus=UserStatusService,$scope.article=resolvedArticle,$scope.pasted=function($event){$event.target.innerText=$event.target.innerText+$event.originalEvent.clipboardData.getData("text/plain"),$event.originalEvent.preventDefault()},$scope.update=function(toPublish){var article=$scope.article;toPublish&&(article.published=!0),article.updated=(new Date).getTime(),article.$update(function(){$location.path("articles/"+article._id)})},$scope.remove=function(article){if(article){article.$remove();for(var i in $scope.articles)$scope.articles[i]===article&&$scope.articles.splice(i,1)}else $scope.article.$remove(),$location.path("articles")}}]),angular.module("bard.Articles").controller("NewArticleController",["$scope","$location","$sanitize","UserStatusService","ArticlesService",function($scope,$location,$sanitize,UserStatusService,ArticlesService){$scope.userStatus=UserStatusService,$scope.titleError=!1,$scope.contentError=!1,$scope.pasted=function($event){$event.target.innerText=$event.target.innerText+$event.originalEvent.clipboardData.getData("text/plain"),$event.originalEvent.preventDefault()},$scope.create=function(toPublish){if(!this.title)return void($scope.titleError=!0);if(!this.content)return void($scope.contentError=!0);var article=new ArticlesService({title:this.title,subtitle:this.subtitle,content:this.content,published:toPublish});article.$save(function(response){$location.path(toPublish?"/":"articles/"+response._id)})},$scope.shortcuts={"mod+0":function(){return document.execCommand("removeFormat"),document.execCommand("formatBlock",!1,"div"),document.execCommand("outdent"),!1},"mod+1":function(){return document.execCommand("formatblock",!1,"h1"),!1},"mod+2":function(){return document.execCommand("formatblock",!1,"h2"),!1},"mod+b":function(){return document.execCommand("bold"),!1},"mod+i":function(){return document.execCommand("italic"),!1},"mod+u":function(){return document.execCommand("underline"),!1},"mod+shift+a":function(){return document.execCommand("justifyleft"),!1},"mod+shift+d":function(){return document.execCommand("justifyright"),!1},"mod+shift+s":function(){return document.execCommand("justifycenter"),!1},"mod+shift+!":function(){return document.execCommand("formatblock",!1,"blockquote"),!1},tab:function(){return document.execCommand("indent"),!1},"shift+tab":function(){return document.execCommand("outdent"),!1}}}]),angular.module("bard.Articles").controller("SeeArticleController",["$scope","$routeParams","$location","$window","$timeout","UserStatusService","ArticlesService","resolvedArticle",function($scope,$routeParams,$location,$window,$timeout,UserStatusService,ArticlesService,resolvedArticle){$scope.userStatus=UserStatusService,$scope.article=resolvedArticle,$scope.remove=function(article){if(article){article.$remove();for(var i in $scope.articles)$scope.articles[i]===article&&$scope.articles.splice(i,1)}else $scope.article.$remove(),$location.path("articles")}}]),angular.module("bard.Authors").controller("SeeAuthorController",["$scope","$routeParams","$location","UserStatusService","AuthorsService","resolvedAuthor",function($scope,$routeParams,$location,UserStatusService,AuthorsService,resolvedAuthor){$scope.userStatus=UserStatusService,$scope.author=resolvedAuthor}]),angular.module("bard.UserStatus").controller("UserStatusController",["$scope","$timeout","UserStatusService",function($scope,$timeout,UserStatusService){$scope.userStatus=UserStatusService,$scope.isCollapsed=!1}]),angular.module("bard").config(["$routeProvider",function($routeProvider){$routeProvider.when("/articles",{templateUrl:"bard/Articles/AllArticles/AllArticlesView.html",controller:"AllArticlesController",resolve:{resolvedArticles:function(ArticlesService,$q){var deferred=$q.defer();return ArticlesService.query(function(articles){deferred.resolve(articles)}),deferred.promise}}}).when("/articles/create",{templateUrl:"bard/Articles/NewArticle/NewArticleView.html",controller:"NewArticleController"}).when("/articles/:articleId/edit",{templateUrl:"bard/Articles/EditArticle/EditArticleView.html",controller:"EditArticleController",resolve:{resolvedArticle:function(ArticlesService,$q,$route){var deferred=$q.defer();return ArticlesService.get({articleId:$route.current.params.articleId},function(article){article.contentClone=article.content,deferred.resolve(article)}),deferred.promise}}}).when("/articles/:articleId",{templateUrl:"bard/Articles/SeeArticle/SeeArticleView.html",controller:"SeeArticleController",resolve:{resolvedArticle:function(ArticlesService,$q,$route){var deferred=$q.defer();return ArticlesService.get({articleId:$route.current.params.articleId},function(article){deferred.resolve(article)}),deferred.promise}}}).when("/users/:username",{templateUrl:"bard/Authors/SeeAuthor/SeeAuthorView.html",controller:"SeeAuthorController",resolve:{resolvedAuthor:function(AuthorsService,$q,$route){var deferred=$q.defer();return AuthorsService.get({username:$route.current.params.username},function(author){deferred.resolve(author)}),deferred.promise}}}).when("/",{templateUrl:"bard/Articles/AllArticles/AllArticlesView.html",controller:"AllArticlesController",resolve:{resolvedArticles:function(ArticlesService,$q){var deferred=$q.defer();return ArticlesService.query(function(articles){deferred.resolve(articles)}),deferred.promise}}}).otherwise({redirectTo:"/"})}]),angular.module("bard").config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,["bard"])});