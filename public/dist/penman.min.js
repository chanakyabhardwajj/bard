"use strict";angular.module("penman",["ngCookies","ngResource","ngRoute","ngSanitize","ui.bootstrap","ui.route","penman.Articles","penman.Authors","penman.UserStatus"]),angular.module("penman.Articles",[]),angular.module("penman.Authors",[]),angular.module("penman.UserStatus",[]),angular.module("penman.Articles").factory("ArticlesService",["$resource",function($resource){return $resource("articles/:articleId",{articleId:"@_id"},{update:{method:"PUT"}})}]),angular.module("penman.Authors").factory("AuthorsService",["$resource",function($resource){return $resource("users/:username",{username:"@username"})}]),angular.module("penman.UserStatus").factory("UserStatusService",[function(){var _this=this;return _this._data={user:window.user,authenticated:!!window.user},_this._data}]).factory("FlickrService",["$resource",function($resource){return $resource("http://api.flickr.com/services/rest/",{user_id:"9669844@N02",method:"flickr.people.getPublicPhotos",api_key:"af9bf878c9f4e37cfeaf2c596de6431d",format:"json",nojsoncallback:"1"},{fetch:{method:"GET",isArray:!1,transformResponse:function(data){var resp=JSON.parse(data),photo=resp.photos.photo[Math.floor(Math.random()*(resp.photos.photo.length-1))],baseUrl="http://farm"+photo.farm+".static.flickr.com/"+photo.server+"/"+photo.id+"_"+photo.secret+"_b.jpg";return console.log(baseUrl),{flickrURL:baseUrl}}}})}]),angular.module("penman.Articles").directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",link:function(scope,element,attrs,ngModel){function read(){var html=element.html();attrs.stripBr&&"<br>"===html&&(html=""),ngModel.$setViewValue(html)}ngModel&&(ngModel.$render=function(){element.html(ngModel.$viewValue||"")},ngModel.$setPristine(),ngModel.$dirty=!1,element.on("blur keyup change",function(){scope.$apply(read)}),read())}}}).directive("keypress",function(){function bindKey(k,scope,element,attributes){window.Mousetrap.bind(k,function(){return attributes[k](scope,element)})}return function(scope,element,attrs){var attributes=scope.$eval(attrs.keypress||"{}");for(var k in attributes)bindKey(k,scope,element,attributes)}}).directive("backImg",function(){return function(scope,element,attrs){var url=attrs.backImg;element.css({"background-image":"url("+url+")","background-size":"cover"})}}),angular.module("penman.Articles").filter("fromNow",["$window",function($window){return function(date){return $window.moment(date).fromNow()}}]).filter("truncate",function(){return function(value,wordwise,max,tail){if(!value)return"";if(max=parseInt(max,10),!max)return value;if(value.length<=max)return value;if(value=value.substr(0,max),wordwise){var lastspace=value.lastIndexOf(" ");-1!==lastspace&&(value=value.substr(0,lastspace))}return value+(tail||" â€¦")}}),angular.module("penman.UserStatus").directive("typer",function(){return{restrict:"A",link:function(scope,element,attrs){angular.element(element).typer(scope.$eval(attrs.typer))}}}),angular.module("penman.Articles").controller("AllArticlesController",["$scope","$window","$timeout","UserStatusService","ArticlesService",function($scope,$window,$timeout,UserStatusService,ArticlesService){$scope.userStatus=UserStatusService,$scope.find=function(){ArticlesService.query(function(articles){$scope.articles=articles,$timeout(function(){window.skrollr.get().refresh()})})}}]),angular.module("penman.Articles").controller("EditArticleController",["$scope","$routeParams","$location","$timeout","$sanitize","UserStatusService","ArticlesService",function($scope,$routeParams,$location,$timeout,$sanitize,UserStatusService,ArticlesService){$scope.userStatus=UserStatusService,$scope.pasted=function($event){$event.target.innerText=$event.originalEvent.clipboardData.getData("text/plain"),$event.originalEvent.preventDefault()},$scope.update=function(){var article=$scope.article;article.updated=(new Date).getTime(),article.$update(function(){$location.path("articles/"+article._id)})},$scope.remove=function(article){if(article){article.$remove();for(var i in $scope.articles)$scope.articles[i]===article&&$scope.articles.splice(i,1)}else $scope.article.$remove(),$location.path("articles")},$scope.findOne=function(){ArticlesService.get({articleId:$routeParams.articleId},function(article){$scope.article=article,$timeout(function(){window.skrollr.get().refresh()})})}}]),angular.module("penman.Articles").controller("NewArticleController",["$scope","$location","$sanitize","UserStatusService","ArticlesService",function($scope,$location,$sanitize,UserStatusService,ArticlesService){$scope.userStatus=UserStatusService,$scope.titleError=!1,$scope.contentError=!1,$scope.pasted=function($event){$event.target.innerText=$event.originalEvent.clipboardData.getData("text/plain"),$event.originalEvent.preventDefault()},$scope.create=function(toPublish){if(!this.title)return void($scope.titleError=!0);if(!this.content)return void($scope.contentError=!0);var article=new ArticlesService({title:this.title,subtitle:this.subtitle,content:this.content,published:toPublish});article.$save(function(response){$location.path(toPublish?"articles/"+response._id+"/edit":"articles/"+response._id)}),this.title="",this.subtitle="",this.content=""},$scope.shortcuts={"mod+0":function(){return document.execCommand("removeFormat"),document.execCommand("formatBlock",!1,"div"),document.execCommand("outdent"),!1},"mod+1":function(){return document.execCommand("formatblock",!1,"h1"),!1},"mod+2":function(){return document.execCommand("formatblock",!1,"h2"),!1},"mod+b":function(){return document.execCommand("bold"),!1},"mod+i":function(){return document.execCommand("italic"),!1},"mod+u":function(){return document.execCommand("underline"),!1},"mod+shift+a":function(){return document.execCommand("justifyleft"),!1},"mod+shift+d":function(){return document.execCommand("justifyright"),!1},"mod+shift+s":function(){return document.execCommand("justifycenter"),!1},"mod+shift+!":function(){return document.execCommand("formatblock",!1,"blockquote"),!1},tab:function(){return document.execCommand("indent"),!1},"shift+tab":function(){return document.execCommand("outdent"),!1}}}]),angular.module("penman.Articles").controller("SeeArticleController",["$scope","$routeParams","$location","$window","$timeout","UserStatusService","ArticlesService",function($scope,$routeParams,$location,$window,$timeout,UserStatusService,ArticlesService){$scope.userStatus=UserStatusService,$scope.remove=function(article){if(article){article.$remove();for(var i in $scope.articles)$scope.articles[i]===article&&$scope.articles.splice(i,1)}else $scope.article.$remove(),$location.path("articles")},$scope.findOne=function(){ArticlesService.get({articleId:$routeParams.articleId},function(article){$scope.article=article,$timeout(function(){window.skrollr.get().refresh()})})}}]),angular.module("penman.Authors").controller("SeeAuthorController",["$scope","$routeParams","$location","UserStatusService","AuthorsService",function($scope,$routeParams,$location,UserStatusService,AuthorsService){$scope.userStatus=UserStatusService,$scope.findOne=function(){AuthorsService.get({username:$routeParams.username},function(author){$scope.author=author})}}]),angular.module("penman.UserStatus").controller("UserStatusController",["$scope","$timeout","UserStatusService",function($scope,$timeout,UserStatusService){$scope.userStatus=UserStatusService,$scope.isCollapsed=!1,$timeout(function(){window.skrollr.get().refresh()})}]),angular.module("penman").config(["$routeProvider",function($routeProvider){$routeProvider.when("/articles",{templateUrl:"penman/Articles/AllArticles/AllArticlesView.html"}).when("/articles/create",{templateUrl:"penman/Articles/NewArticle/NewArticleView.html"}).when("/articles/:articleId/edit",{templateUrl:"penman/Articles/EditArticle/EditArticleView.html"}).when("/articles/:articleId",{templateUrl:"penman/Articles/SeeArticle/SeeArticleView.html"}).when("/users/:username",{templateUrl:"penman/Authors/SeeAuthor/SeeAuthorView.html"}).when("/",{templateUrl:"penman/Articles/AllArticles/AllArticlesView.html"}).otherwise({redirectTo:"/"})}]),angular.module("penman").config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){window.skrollr.init(),"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,["penman"])});